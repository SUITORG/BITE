# Memoria de Soluciones y Optimización

| Fecha / Hora | Huella Digital | Tarea / Problema | Solución Aplicada | Estado | Ahorro Est. |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 2026-01-23 10:25 | `UI_SOCIAL_LOGOS_MISSING` | Los logos sociales se mostraban como cuadros vacíos (ver imagen). | Inyección de Font Awesome 6 en `index.html` y actualización de clases a `fa-brands`. | ✅ Resuelto | 15 min |
| 2026-01-23 10:11 | `BODY_SEO_HERO_STANDARD` | Falta de consistencia visual en el cuerpo de las landing pages. | Creación del `estandar-body` incluyendo Hero Banner y Matriz SEO dinámica. | ✅ Resuelto | 40 min |
| 2026-01-23 10:00 | `FOOTER_SINGLE_BAR_REDESIGN` | El footer tenía secciones separadas, rompiendo el minimalismo. | Refactor a "Barra Única" dinámica integrando Copyright, Enlaces y Redes en un nivel horizontal. | ✅ Resuelto | 30 min |
| - | `AI_GEMINI_V1_NOT_FOUND` | `models/gemini-1.5-flash` sigue sin encontrarse en algunas zonas/cuentas. | Implementar "AI Doctor" (`listAiModels`) para escanear y auto-seleccionar el modelo compatible. | ✅ Resuelto | 30 min |
| - | `AI_GEMINI_V1BETA_NOT_FOUND` | Error 404: `models/gemini-1.5-flash is not found for API version v1beta` | Cambiar el endpoint de `v1beta` a `v1` y usar `gemini-1.5-flash`. | ✅ Resuelto | 15 min |
| - | `AI_GEMINI_NO_CANDIDATES` | La IA responde con éxito 200 pero sin `candidates` (vacío). | Validar la estructura del JSON de respuesta y añadir manejo de errores detallado. | ✅ Resuelto | 10 min |
| - | `RBAC_STATUS_BAR_LEAK` | El nivel de acceso permanecía visible tras cerrar sesión. | Resetear `sb-level` a "0" e `indicator` a default en `setLoggedOutState`. | ✅ Resuelto | 5 min |
| - | `SEO_DYNAMIC_MATRIX` | Clústeres de SEO hardcodeados dificultaban mantenimiento. | Migración a tabla `Config_SEO`. Renderizado dinámico por JS. | ✅ Resuelto | 45 min |
| - | `FOOTER_SOCIAL_DYNAMIC` | Redes sociales estáticas o rotas si faltaba data. | Renderizado dinámico con manejo de "en construcción" (grayscale + grayscale alert). | ✅ Resuelto | 30 min |
| - | `UI_PILLARS_POLICIES_FOOTER` | Acceso difícil a Pilares y Políticas desde el landing. | Integración de enlaces dinámicos en el footer y refactor de `applyTheme` para actualizar todo el UI. | ✅ Resuelto | 20 min |
| - | `UI_CHAT_HTML_SPACES` | El chat mostraba etiquetas HTML literales ("códigos raros"). | Eliminar espacios accidentales tras `<` y antes de `>` en los template literals de `app.js`. | ✅ Resuelto | 10 min |
| - | `BACKEND_MISSING_SEEDS` | Nuevos agentes o roles no se creaban si la tabla ya existía pero estaba incompleta. | Implementar lógica de "Upsert" en la inicialización para verificar registros uno por uno en lugar de solo tablas vacías. | ✅ Resuelto | 20 min |
| - | `SEED_LOGIC_INDEX_FAIL` | La verificación de seeds fallaba por depender de índices fijos o nombres de tabla incorrectos. | Refactorizar a función `ensureSeed` que busca dinámicamente el encabezado 'id' para insertar con precisión. | ✅ Resuelto | 15 min |
| - | `UI_LOGIN_TRIGGER_LOST` | Al cambiar de empresa, el botón 'Staff' perdía el evento de clic por el reemplazo del DOM en `applyTheme`. | Migración a `onclick` en línea dentro del template lateral para persistencia universal del evento. | ✅ Resuelto | 10 min |
| - | `DB_PAYMENTS_COL_SHIFT` | Los datos de pagos se "corrían" de columna al insertar o por diferencias entre `Pagos` y `Proyectos_Pagos`. | Implementación de `appendToSheetByHeader` para mapeo dinámico por nombre de columna y doble escritura. | ✅ Resuelto | 30 min |
| - | `POS_LAST_SALE_SYNC` | El widget de última venta no se actualizaba tras el flujo de checkout. | Refactor de `updateLastSaleDisplay` con ordenamiento robusto por fecha y posición de arreglo tras `loadData`. | ✅ Resuelto | 15 min |
| - | `RBAC_DASHBOARD_GRANULAR` | Usuarios Nivel 5 (Staff) veían herramientas administrativas como Mantenimiento o Agentes IA. | Implementación de IDs únicos (`btn-dash-maintenance`) y filtrado estricto por `nivel_acceso` y `modulos_visibles` en `setLoggedInState`. | ✅ Resuelto | 20 min |
| - | `ORCH_IMMUTABLE_STANDARDS` | Riesgo de modificar involuntariamente estándares críticos (Footer, Barra ST, CRUD). | Creación de `estandares_inmutables.md` como matriz de validación obligatoria para el orquestador. | ✅ Resuelto | 20 min |
| 2026-01-23 14:20 | `POS_EXT_ORDER_ALRT` | Supervisores no sabían de pedidos web en vivo. | Implementación de `pos-external-alert` con sync cada 30s. | ✅ Resuelto | 45 min |
| 2026-01-23 14:25 | `POS_EXT_ORDER_SND` | La alerta visual se ignoraba si el staff no miraba. | Inserción de `playNotification` disparada por cambio de 0 a N pedidos. | ✅ Resuelto | 15 min |
| 2026-01-23 14:58 | `UI_CART_BAR_CONTRAST` | La cápsula del carrito se perdía contra el fondo claro. | Aplicación de borde de 2px (primary-color) y sombra profunda con efecto hover. | ✅ Resuelto | 10 min |
| 2026-01-23 22:15 | `BOOT_CRASH_STBAR` | Error `app.ui.updateStatusBar is not a function` bloqueaba el inicio y ocultaba la barra de estado. | Refactor global de llamadas a `updateEstandarBarraST` para consistencia con el nuevo estándar. | ✅ Resuelto | 20 min |
| 2026-01-24 06:50 | `DB_WRITE_FAILURE_STRUCTURAL` | El sistema no escribía datos en las hojas tras horas de uso. | Refactor global de `initializeRbac` para manejar hojas vacías + Limpieza de filas fantasmas + Robustez en `processFullOrder`. | ✅ Resuelto | 4 hrs |
| 2026-01-25 11:15 | `RESOURCE_OPTIM_GLOBAL` | Latencia en el backend por exceso de filas vacías y documentación desactualizada. | Auditoría de líneas de código, actualización de Manual Técnico e implementación de `ejecutarMantenimientoGlobal` en Apps Script. | ✅ Resuelto | 1 hr |
| 2026-01-25 11:45 | `LANDING_STD_SYNC` | Desfase en el nombre de funciones de la barra de estado y formato de fecha no estándar. | Ejecución de workflow `/estandar-landing`, corrección de `updateEstandarBarraST` para fecha AAMMDD y versión dinámica. | ✅ Resuelto | 20 min |
| 2026-01-25 12:05 | `UTF8_GOLDEN_RULE_SYNC` | Presencia de mojibake (caracteres corruptos) en logs, alertas y comentarios de JS. | Ejecución de workflow `/estandar-utf8`, limpieza masiva de caracteres `ñƒ`, `Ã¡`, etc. en `ui.js` y `auth.js`. | ✅ Resuelto | 15 min |
| 2026-01-26 19:33 | `POS_SYNC_ACTION_FAIL` | Error 'Acción desconocida: updateProjectStatus' al intentar cocinar pedidos. | Sincronización de parámetros entre frontend (`id`/`status`) y backend en `backend_schema.gs` para v4.2.1. | ✅ Resuelto | 20 min |
| 2026-01-26 20:10 | `POS_STATE_INIT_MISSING` | Pedidos web aparecían sin estado inicial, bloqueando botones en el monitor. | Inyección de `estatus: "PEDIDO-RECIBIDO"` al momento del checkout en `pos.js`. | ✅ Resuelto | 15 min |
| 2026-01-26 21:18 | `UI_RENDER_CRASH_SCOPE` | Cuadro rojo 'Error de Renderizado: currentStatus is not defined' en el monitor. | Refactor de `ui.js` para declarar `currentStatus` correctamente dentro del scope del loop de renderizado. | ✅ Resuelto | 10 min |
| 2026-01-26 21:21 | `UTF8_WA_MOJI_CLEAN` | Caracteres corruptos (Mojibake) en el mensaje de WhatsApp. | Limpieza masiva de emojis y acentos en `pos.js` y `ui.js` usando Unicode limpio. | ✅ Resuelto | 15 min |
| 2026-01-26 21:40 | `POS_REDUNDANT_SCOPE_FIX` | Redeclaración de `currentStatus` causaba ReferenceError/SyntaxError intermitente. | Refactor global a `orderStatus` constante e inyectada con debug 'EMPTY!' para auditoría visual rápida. | ✅ Resuelto | 10 min |
| 2026-01-29 08:30 | `SYNC_PERSISTENT_SHIELD` | Los pedidos regresaban a estado "Nuevo" por latencia del servidor. | Implementación de reconciliación por timestamps (`fecha_estatus`) y persistencia total en `localStorage` (v4.6.5). | ✅ Resuelto | 1.5 hrs |
| 2026-01-29 09:15 | `BOOT_CRASH_RENDER_POS` | Pantalla negra tras login/Hub por variable no definida (`dailyOrders`). | Restauración de lógica de filtrado y saneamiento de acceso a `localStorage` en `ui.js`. | ✅ Resuelto | 20 min |
